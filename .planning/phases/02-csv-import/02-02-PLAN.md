---
phase: 02-csv-import
plan: 02
type: execute
---

<objective>
Integrate CSV import into wizard: file selection prompt, parsing, and validation display.

Purpose: Connect the data layer from 02-01 to the Spectre.Console wizard UI.
Output: Working import flow where user selects CSV file and sees validation results.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
~/.claude/get-shit-done/templates/summary.md
~/.claude/get-shit-done/references/checkpoints.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-csv-import/02-01-SUMMARY.md

**Prior decisions affecting this phase:**
- Two-panel layout with Steps (left) and Content (right)
- 8-step wizard progression model
- Step 1 = ImportCsv, Step 2 = ValidateCsv

**Relevant source files:**
@Program.cs
@UI/AppLayout.cs
@UI/StepMenu.cs
@Models/WizardState.cs
@Models/Song.cs
@Services/CsvParser.cs
</context>

<tasks>

<task type="auto">
  <name>Task 1: Implement file selection step</name>
  <files>UI/Steps/ImportCsvStep.cs, Program.cs</files>
  <action>
Create ImportCsvStep.cs with a static Run method:
- Display welcome message explaining expected CSV format (title;artist;year;genre)
- Use AnsiConsole.Prompt with TextPrompt<string> to ask for file path
- Validate file exists using File.Exists()
- If file doesn't exist, show error in red and re-prompt
- Return the validated file path

Update Program.cs:
- Replace static welcome content with a wizard loop
- When CurrentStep is ImportCsv, call ImportCsvStep.Run()
- Store the file path for next step
- Call wizardState.AdvanceToNextStep() after successful import
- Re-render layout after each step

Use Spectre.Console patterns:
- AnsiConsole.MarkupLine for styled output
- AnsiConsole.Prompt for input
- Panel for structured content display
  </action>
  <verify>dotnet run, enter a non-existent path (shows error), enter valid path (accepts and advances)</verify>
  <done>ImportCsvStep prompts for file, validates existence, advances wizard on success</done>
</task>

<task type="auto">
  <name>Task 2: Implement validation display step</name>
  <files>UI/Steps/ValidateCsvStep.cs, Program.cs</files>
  <action>
Create ValidateCsvStep.cs with a static Run method that takes file path:
- Call CsvParser.ParseFile(filePath)
- Display summary: "Found X songs, Y valid, Z with errors"
- Show a Table with columns: #, Title, Artist, Year, Genre, Status
- For valid songs: Status = "[green]Valid[/]"
- For invalid songs: Status = "[red]Error: {first error}[/]"
- Limit display to first 20 rows if more, with "...and X more" message
- If all valid: Show success message in green, prompt to continue
- If errors exist: Show warning, ask user to fix CSV and re-import OR continue with valid songs only
- Return the list of valid songs for subsequent steps

Update Program.cs:
- When CurrentStep is ValidateCsv, call ValidateCsvStep.Run(filePath)
- Store the returned valid songs list in a new AppState class or extend WizardState
- Handle user choice to go back or continue
- Advance to next step if user continues
  </action>
  <verify>dotnet run with test CSV containing valid and invalid rows, confirm table displays correctly</verify>
  <done>ValidateCsvStep parses CSV, displays validation table, handles user choice to continue or fix</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Complete CSV import wizard flow with file selection and validation display</what-built>
  <how-to-verify>
    1. Run: dotnet run
    2. Verify: FIGlet header and step menu display correctly
    3. Verify: Step 1 "Import CSV" is highlighted (yellow arrow)
    4. Enter a non-existent file path -> should show red error and re-prompt
    5. Create a test CSV file with content:
       ```
       title;artist;year;genre
       Bohemian Rhapsody;Queen;1975;Rock
       Bad Song;;2020;InvalidGenre
       Billie Jean;Michael Jackson;1982;Pop
       ```
    6. Enter the test CSV path -> should advance to step 2
    7. Verify: Step 2 "Validate CSV" is now highlighted
    8. Verify: Table shows 3 songs with validation status
    9. Verify: "Bad Song" shows errors (missing artist, invalid genre)
    10. Verify: Other songs show green "Valid" status
    11. Choose to continue with valid songs
    12. Verify: Wizard advances to step 3 (Spotify Auth - placeholder for now)
  </how-to-verify>
  <resume-signal>Type "approved" to continue, or describe issues to fix</resume-signal>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `dotnet build` succeeds without errors
- [ ] File selection prompts and validates file existence
- [ ] CSV parsing displays results in formatted table
- [ ] Invalid songs show specific error messages
- [ ] User can choose to continue with valid songs or go back
- [ ] Wizard state advances correctly through steps
</verification>

<success_criteria>
- All tasks completed
- All verification checks pass
- Human verification approved
- Phase 2 complete - CSV import and validation working end-to-end
</success_criteria>

<output>
After completion, create `.planning/phases/02-csv-import/02-02-SUMMARY.md`
</output>
