---
phase: 18-playlist-builder
plan: 01
type: execute
---

<objective>
Implement playlist builder with track selection from search and playlist management.

Purpose: Enable users to build a custom playlist from Spotify search results as an alternative to CSV upload.
Output: Playlist store, updated SpotifySearch with add functionality, PlaylistBuilder component with genre picker and remove.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

**Prior phase summary:**
@.planning/phases/17-spotify-search/17-01-SUMMARY.md

**Key patterns to follow:**
- Store pattern: `web/src/lib/stores/cardCustomization.svelte.ts` (Svelte 5 runes, localStorage persistence)
- Component pattern: `web/src/lib/SpotifySearch.svelte` (result cards with hover states)
- Type definitions: `web/src/lib/types.ts` (SearchResult, MatchResult interfaces)

**Data flow:**
- SearchResult (from search) → PlaylistTrack (with genre) → MatchResult (for preview)
- PlaylistTrack needs: all SearchResult fields + user-selected genre
- Conversion to MatchResult maps: trackName→originalTitle, artistName→originalArtist, releaseYear→originalYear, genre→originalGenre
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create playlist store and update SpotifySearch</name>
  <files>web/src/lib/stores/playlist.svelte.ts, web/src/lib/types.ts, web/src/lib/SpotifySearch.svelte</files>
  <action>
1. Add PlaylistTrack interface to types.ts:
   - Extends SearchResult fields (trackId, trackName, artistName, albumName, albumImageUrl, spotifyUrl, releaseYear)
   - Adds: genre (string, default "Pop")

2. Create playlist.svelte.ts store following cardCustomization.svelte.ts pattern:
   - State: `tracks = $state<PlaylistTrack[]>([])` (no localStorage - session only)
   - Functions: addTrack(result: SearchResult), removeTrack(trackId: string), clearPlaylist(), getPlaylistState()
   - addTrack converts SearchResult to PlaylistTrack with default genre "Pop"
   - Prevent duplicates (check trackId before adding)

3. Update SpotifySearch.svelte:
   - Add prop: `onAddTrack?: (track: SearchResult) => void`
   - Add "+" button to each result card (right side, same row as track info)
   - Button: green bg (#1DB954), white "+" text, rounded-full, hover effect
   - On click: call onAddTrack(result)
   - If track already in playlist (check via prop `playlistTrackIds?: Set<string>`), show checkmark instead of "+"
  </action>
  <verify>
1. Check types.ts has PlaylistTrack interface
2. Check playlist.svelte.ts exports addTrack, removeTrack, clearPlaylist, getPlaylistState
3. Check SpotifySearch has onAddTrack prop and "+" button renders
  </verify>
  <done>Playlist store created with add/remove functions, SpotifySearch shows add button on results</done>
</task>

<task type="auto">
  <name>Task 2: Create PlaylistBuilder component</name>
  <files>web/src/lib/PlaylistBuilder.svelte</files>
  <action>
Create PlaylistBuilder.svelte component that displays playlist with editing capabilities:

1. Props:
   - tracks: PlaylistTrack[]
   - onRemoveTrack: (trackId: string) => void
   - onUpdateGenre: (trackId: string, genre: string) => void
   - onContinueToPreview: () => void

2. Layout (vertical stack):
   - Header: "Your Playlist" with track count badge
   - Track list (scrollable, max-height similar to SpotifySearch results)
   - Each track row:
     - Album art (48x48)
     - Track info (title, artist - year)
     - Genre dropdown (select element with DEFAULT_GENRE_COLORS keys as options, styled to match app)
     - Remove button (red X, hover effect)
   - Footer: "Continue to Preview" button (disabled if empty)

3. Styling:
   - Match SpotifySearch aesthetic (#282828 bg, #1DB954 accent, #FF6B6B for remove)
   - Genre dropdown: custom styled select matching dark theme
   - Smooth transitions on hover/remove

4. Import DEFAULT_GENRE_COLORS from cardCustomization for genre options

5. Empty state: "Search for tracks and add them to your playlist"
  </action>
  <verify>
1. Component file exists at web/src/lib/PlaylistBuilder.svelte
2. Check component has all required props (tracks, onRemoveTrack, onUpdateGenre, onContinueToPreview)
3. Check genre dropdown uses DEFAULT_GENRE_COLORS keys
  </verify>
  <done>PlaylistBuilder displays tracks with album art, genre picker, remove button, and continue action</done>
</task>

</tasks>

<verification>
Before declaring phase complete:
- [ ] PlaylistTrack type defined in types.ts
- [ ] playlist.svelte.ts store has add/remove/clear functions
- [ ] SpotifySearch shows "+" button on results
- [ ] PlaylistBuilder renders tracks with genre dropdown and remove
- [ ] All files lint/type-check without errors
</verification>

<success_criteria>

- All tasks completed
- All verification checks pass
- Playlist store manages track state correctly
- SpotifySearch add button works
- PlaylistBuilder shows tracks with genre editing and remove functionality
- No TypeScript errors
</success_criteria>

<output>
After completion, create `.planning/phases/18-playlist-builder/18-01-SUMMARY.md`:

# Phase 18 Plan 01: Playlist Builder Summary

**[Substantive one-liner]**

## Accomplishments

- [Key outcome 1]
- [Key outcome 2]

## Files Created/Modified

- `path/to/file.ts` - Description

## Decisions Made

[Key decisions and rationale, or "None"]

## Issues Encountered

[Problems and resolutions, or "None"]

## Next Step

Ready for Phase 19 (Flow Integration) or additional UI polish
</output>
