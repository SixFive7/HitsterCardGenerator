---
phase: 17-spotify-search
plan: 01
type: execute
---

<objective>
Add Spotify search functionality - backend endpoint + frontend UI component.

Purpose: Enable users to search Spotify directly from the app as the first step toward building playlists without CSV upload.
Output: Working search endpoint at /api/search and SpotifySearch.svelte component displaying results.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

**Phase context (from /gsd:discuss-phase):**
@.planning/phases/17-spotify-search/17-CONTEXT.md

**Key requirements from context:**
- Speed - results appear fast, no waiting
- Simplicity - dead simple search box, zero learning curve
- Visual - album artwork thumbnails with each result
- Match existing aesthetic - Spotify-inspired dark theme colors

**Out of scope (Phase 18):**
- Adding/removing tracks from playlist
- Audio previews / play buttons
- Any track selection/action

**Existing patterns to follow:**
@Services/SpotifyService.cs - has SearchTrackAsync() using SpotifyAPI.Web
@Endpoints/MatchEndpoints.cs - endpoint pattern with SpotifyService
@web/src/lib/api.ts - frontend API client pattern
@web/src/lib/types.ts - TypeScript interfaces
@web/src/App.svelte - component patterns, color scheme (#1DB954, #FF6B6B, #191414, #282828)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add search API endpoint</name>
  <files>Endpoints/SearchEndpoints.cs, Program.cs</files>
  <action>
Create SearchEndpoints.cs with:
- MapSearchEndpoints extension method
- GET /api/search?q={query} endpoint
- Use SpotifyService with fresh auth per request (same pattern as MatchEndpoints)
- Call client.Search.Item() with the query directly (free-form search, not artist/title filtered)
- Return array of tracks with: trackId, trackName, artistName, albumName, albumImageUrl, spotifyUrl, releaseYear
- Limit to 20 results for speed
- Return empty array if query is empty or whitespace

Register in Program.cs with app.MapSearchEndpoints().

Use SearchRequest.Types.Track for track-only results.
</action>
  <verify>curl "http://localhost:5657/api/search?q=bohemian%20rhapsody" returns JSON array with track results</verify>
  <done>Search endpoint returns Spotify tracks, empty query returns empty array, no auth errors</done>
</task>

<task type="auto">
  <name>Task 2: Create SpotifySearch component</name>
  <files>web/src/lib/SpotifySearch.svelte, web/src/lib/api.ts, web/src/lib/types.ts</files>
  <action>
**Add TypeScript types (types.ts):**
- SearchResult interface: trackId, trackName, artistName, albumName, albumImageUrl, spotifyUrl, releaseYear

**Add API function (api.ts):**
- searchSpotify(query: string): Promise&lt;SearchResult[]&gt;
- GET /api/search?q={encodeURIComponent(query)}
- Return empty array on empty query (don't call API)

**Create SpotifySearch.svelte:**
- Search input with placeholder "Search Spotify..."
- Use Svelte 5 runes ($state for query, results, isLoading)
- Debounce search (300ms) - don't search until user stops typing
- Show loading spinner during search
- Display results as cards with:
  - Album artwork thumbnail (64x64 or similar)
  - Track name (white, bold)
  - Artist name (gray)
  - Year (gray, smaller)
- Style to match app aesthetic:
  - Dark background (#282828)
  - Green accents (#1DB954)
  - Rounded corners, hover states
  - Results in a scrollable list

Keep component standalone - no track selection (that's Phase 18).
Input should auto-focus on mount for immediate typing.
</action>
  <verify>npm run dev, navigate to component, type "queen" - results appear after brief delay with album art</verify>
  <done>Search input works, debounced, shows loading state, displays results with thumbnails matching app theme</done>
</task>

</tasks>

<verification>
Before declaring phase complete:
- [ ] `dotnet build` succeeds
- [ ] `npm run build` in web/ succeeds
- [ ] Search endpoint returns results for valid queries
- [ ] Search UI displays results with album artwork
- [ ] Empty/whitespace queries handled gracefully
- [ ] UI matches existing Spotify-inspired theme
</verification>

<success_criteria>
- Backend search endpoint functional at /api/search
- Frontend search component displays Spotify results with thumbnails
- Search is debounced (no API spam)
- UI matches existing app aesthetic
- No errors in console (backend or frontend)
</success_criteria>

<output>
After completion, create `.planning/phases/17-spotify-search/17-01-SUMMARY.md`:

# Phase 17 Plan 01: Spotify Search Summary

**[One-liner: what shipped]**

## Accomplishments
- [Key outcomes]

## Files Created/Modified
- `path/to/file` - Description

## Decisions Made
[Key decisions and rationale, or "None"]

## Issues Encountered
[Problems and resolutions, or "None"]

## Next Step
Ready for Phase 18 (Playlist Builder) - adding track selection to search results
</output>
