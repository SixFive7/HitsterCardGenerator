---
phase: 13-dev-experience
plan: 01
type: execute
---

<objective>
Enable single-keystroke F5 development workflow with HMR support.

Purpose: Make the development inner loop fast and seamless - one F5 starts everything, frontend changes reflect instantly via HMR, no unnecessary build steps slow things down.
Output: Updated VS Code configuration files and MSBuild target that enable compound launch with Vite HMR.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/13-dev-experience/13-CONTEXT.md
@.planning/phases/13-dev-experience/13-RESEARCH.md

**Prior decisions affecting this phase:**
- Phase 11: Vite outputs directly to wwwroot (no copy step needed)
- Phase 11: MSBuild datetime comparison unreliable, use Exists() check for NpmInstall

**Current state:**
- .NET API runs on port 5657
- Vite dev server runs on port 5173 with proxy to /api
- NpmBuild currently runs on every build (needs Release-only condition)
- Basic VS Code configs exist but lack compound launch

**Key insight from research:**
Access Vite directly at port 5173 during development for HMR. The compound launch starts both servers; developer opens browser to Vite port for full HMR experience.
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add Release-only condition to NpmBuild target</name>
  <files>HitsterCardGenerator.csproj</files>
  <action>
Add `Condition="'$(Configuration)' == 'Release'"` to the NpmBuild target. This ensures:
- Debug builds skip npm build (fast iteration)
- Release builds include frontend (production packaging)

The NpmInstall target should also be gated to Release since it's only needed when NpmBuild runs.

Change from:
```xml
<Target Name="NpmInstall" BeforeTargets="NpmBuild" Condition="!Exists('web/node_modules')">
<Target Name="NpmBuild" BeforeTargets="Build">
```

To:
```xml
<Target Name="NpmInstall" BeforeTargets="NpmBuild" Condition="'$(Configuration)' == 'Release' And !Exists('web/node_modules')">
<Target Name="NpmBuild" BeforeTargets="Build" Condition="'$(Configuration)' == 'Release'">
```
  </action>
  <verify>
Run `dotnet build -c Debug` - should NOT show "Building frontend..." message
Run `dotnet build -c Release` - should show "Building frontend..." message
  </verify>
  <done>Debug builds skip npm, Release builds include npm build</done>
</task>

<task type="auto">
  <name>Task 2: Update tasks.json with debug/release/vite tasks</name>
  <files>.vscode/tasks.json</files>
  <action>
Replace current tasks.json with comprehensive task configuration:

1. `build-debug` - dotnet build with Debug configuration (fast, no npm)
2. `build-release` - dotnet build with Release configuration (includes npm build)
3. `vite-dev` - Background npm task that runs Vite dev server with problem matcher

Critical for vite-dev task:
- Use `"isBackground": true` so task doesn't block
- Add problem matcher with `activeOnStart: true` and patterns for Vite output
- Use `beginsPattern: "VITE"` and `endsPattern: "ready in"` to detect server ready
- Set presentation to `"reveal": "silent"` to avoid terminal focus stealing

Keep existing `publish` and `watch` tasks for compatibility.
  </action>
  <verify>
Run task "build-debug" from VS Code command palette - should complete without npm build
Run task "vite-dev" from VS Code command palette - should start Vite and show "ready" state
  </verify>
  <done>All four tasks defined: build-debug, build-release, vite-dev, plus existing publish/watch</done>
</task>

<task type="auto">
  <name>Task 3: Update launch.json with compound configuration</name>
  <files>.vscode/launch.json</files>
  <action>
Replace current launch.json with compound launch support:

1. `.NET API (Debug)` - Launch .NET with preLaunchTask "build-debug"
   - Remove serverReadyAction (we want Vite port 5173, not .NET port 5657)
   - Keep ASPNETCORE_ENVIRONMENT=Development
   - Disable moduleLoad logging for cleaner output

2. `Vite Dev Server` - Launch node with npm run dev
   - Use runtimeExecutable "npm" with runtimeArgs ["run", "dev"]
   - Set cwd to web folder
   - Use integratedTerminal console

3. `.NET Core Attach` - Keep existing attach configuration

4. `Full Stack (F5)` compound:
   - Combine ".NET API (Debug)" and "Vite Dev Server"
   - Set `stopAll: true` to stop both on debug stop
   - Place first in order so it's the default F5 action

Add comments explaining each configuration option for future maintainers.
  </action>
  <verify>
Press F5 in VS Code - should see both .NET and Vite starting in debug console
Check Debug dropdown shows "Full Stack (F5)" as first option
  </verify>
  <done>Compound launch config enables single F5 to start full stack development</done>
</task>

</tasks>

<verification>
Before declaring phase complete:
- [ ] `dotnet build -c Debug` completes in <5 seconds (no npm build)
- [ ] `dotnet build -c Release` runs npm build and succeeds
- [ ] F5 in VS Code starts both .NET API and Vite dev server
- [ ] Vite HMR works (edit a .svelte file, see instant update at localhost:5173)
- [ ] Stopping debug (Shift+F5) stops both servers
</verification>

<success_criteria>
- All tasks completed
- All verification checks pass
- Single F5 starts full development environment
- Debug builds are fast (skip npm)
- HMR works for frontend changes
</success_criteria>

<output>
After completion, create `.planning/phases/13-dev-experience/13-01-SUMMARY.md`:

# Phase 13 Plan 01: Dev Experience Summary

**[Substantive one-liner]**

## Accomplishments
- [Key outcomes]

## Files Created/Modified
- `HitsterCardGenerator.csproj` - Added Release-only condition to NpmBuild
- `.vscode/tasks.json` - Added debug/release/vite tasks
- `.vscode/launch.json` - Added compound launch configuration

## Decisions Made
[Any decisions made during implementation]

## Issues Encountered
[Problems and resolutions, or "None"]

## Next Step
Phase 13 complete, ready for Phase 14: Docker Image
</output>
