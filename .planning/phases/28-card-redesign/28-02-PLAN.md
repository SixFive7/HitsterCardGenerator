# Plan 28-02: Frontend Integration and Visual Verification

## Objective

Update Svelte components to pass album data to the card preview API and verify the new card design visually using Chrome DevTools MCP.

## Prerequisites

- Plan 28-01 complete (backend changes)
- Application builds successfully

## Execution Tasks

### Task 1: Update TypeScript types for album data

**File:** `web/src/lib/types.ts`

Update `ExportCard` interface to include album data:
```typescript
export interface ExportCard {
  trackId: string
  title: string
  artist: string
  year: number
  genre: string
  albumImageUrl?: string  // Add
  albumName?: string      // Add
}
```

Note: `SpotifyMatch` already has `albumImageUrl` and `albumName`.

**Verification:** TypeScript compiles without errors

---

### Task 2: Update CardImage component props

**File:** `web/src/lib/CardPreview/CardImage.svelte`

Add new props:
```typescript
interface Props {
  side: 'front' | 'back'
  trackId: string
  title: string
  artist: string
  year: number
  genre: string
  backgroundColor: string
  albumImageUrl?: string  // Add
  albumName?: string      // Add
}
```

Update fetch to include these in the request body.

**Verification:** TypeScript compiles without errors

---

### Task 3: Update CardFront component props

**File:** `web/src/lib/CardPreview/CardFront.svelte`

Add albumImageUrl and albumName props (passthrough to CardImage):
```typescript
interface Props {
  trackId: string
  title: string
  artist: string
  year: number
  genre: string
  backgroundColor: string
  albumImageUrl?: string  // Add
  albumName?: string      // Add
}
```

Pass to CardImage component.

**Verification:** TypeScript compiles without errors

---

### Task 4: Update CardBack component props

**File:** `web/src/lib/CardPreview/CardBack.svelte`

Add albumImageUrl and albumName props (passthrough to CardImage):
```typescript
interface Props {
  trackId: string
  title: string
  artist: string
  year: number
  genre: string
  backgroundColor: string
  albumImageUrl?: string  // Add
  albumName?: string      // Add
}
```

Pass to CardImage component.

**Verification:** TypeScript compiles without errors

---

### Task 5: Update CardCarousel to pass album data

**File:** `web/src/lib/CardPreview/CardCarousel.svelte`

Extract album data from MatchResult and pass to CardFront/CardBack:
```svelte
<CardFront
  trackId={extractTrackId(card.match?.spotifyUrl)}
  title={card.originalTitle}
  artist={card.originalArtist}
  year={card.originalYear}
  genre={card.originalGenre}
  backgroundColor={getGenreColor(card.originalGenre)}
  albumImageUrl={card.match?.albumImageUrl}
  albumName={card.match?.albumName}
/>
```

Also update preloadCardImage function to include album data.

**Verification:** TypeScript compiles without errors

---

### Task 6: Update export functionality to include album data

**File:** Look for the component that builds ExportCard objects (likely in CardPreview.svelte or similar)

Ensure album data is passed when building export requests:
```typescript
const exportCards: ExportCard[] = cards.map(card => ({
  trackId: extractTrackId(card.match?.spotifyUrl),
  title: card.originalTitle,
  artist: card.originalArtist,
  year: card.originalYear,
  genre: card.originalGenre,
  albumImageUrl: card.match?.albumImageUrl,
  albumName: card.match?.albumName
}))
```

**Verification:** TypeScript compiles, build succeeds

---

### Task 7: Build and start application

Run:
```bash
dotnet build
dotnet run
```

**Verification:** Application starts without errors on port 5000

---

### Task 8: Visual verification - Navigate to application

Use Chrome DevTools MCP to navigate to the application and load test data.

Steps:
1. Navigate to http://localhost:5000
2. Take snapshot to verify page loads

**Verification:** Page loads successfully

---

### Task 9: Visual verification - Test with sample data

Load sample CSV or playlist to get cards with Spotify matches.

Steps:
1. Upload test CSV or use playlist feature
2. Process to get card matches
3. Navigate to card preview

**Verification:** Cards appear in preview carousel

---

### Task 10: Visual verification - Front card design

Take screenshot of front card to verify:
1. Genre background color fills card
2. QR code is centered
3. Genre text appears below QR code
4. Text is readable against background

**Verification:** Screenshot shows expected front card layout

---

### Task 11: Visual verification - Back card design

Click card to flip, then verify:
1. Genre background color fills card
2. Year and genre appear in top bar with semi-transparent background
3. Album art is centered
4. Artist, title, album appear in bottom bar with semi-transparent background

**Verification:** Screenshot shows expected back card layout

---

### Task 12: Visual verification - Flip animation

Observe flip animation:
1. Card flips smoothly on click
2. 3D effect is visible
3. Animation completes in ~0.6s

**Verification:** Flip animation works correctly

---

## Completion Criteria

1. All frontend components pass album data
2. TypeScript/Svelte builds without errors
3. Card preview shows new front design (QR + genre text)
4. Card preview shows new back design (album art + text bars)
5. Flip animation works
6. Visual verification complete via Chrome DevTools

## Notes

- If album art fails to load, verify backend error handling
- Album art comes from Spotify API, should be available for all matched tracks
- Semi-transparent backgrounds improve readability on any genre color
