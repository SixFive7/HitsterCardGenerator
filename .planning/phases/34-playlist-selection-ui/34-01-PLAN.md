# Plan 34-01: Playlist Selection UI

## Objective

Implement the playlist selection interface with browser UUID identity, allowing users to see their playlists, create new ones, and select a playlist to work with.

## Context

Phase 34 adds multi-playlist management UI to the landing page. Users will be identified by a browser UUID stored in localStorage, and the UI will show their playlists with the ability to select or create new ones. On first visit, a "My Playlist" is auto-created for a seamless experience.

## Tasks

### Task 1: Browser Identity Store and API Integration

**Files to create:**
- `web/src/lib/stores/browser.svelte.ts` - Browser identity store

**Files to modify:**
- `web/src/lib/api.ts` - Add X-Browser-Id header to all API calls
- `web/src/lib/types.ts` - Add Playlist types

**Implementation:**

1. Create `browser.svelte.ts` store:
   - Check localStorage for `hitster-browser-id`
   - If not found, generate UUID via `crypto.randomUUID()` and store it
   - Export reactive `browserId` getter
   - Export `getBrowserId()` function for API calls

2. Add Playlist types to `types.ts`:
   ```typescript
   export interface Playlist {
     id: string
     browserId: string
     name: string
     trackCount: number
     createdAt: string
     updatedAt: string
   }
   ```

3. Update `api.ts`:
   - Import `getBrowserId` from browser store
   - Create helper function that adds `X-Browser-Id` header
   - Add `fetchPlaylists()` - GET /api/playlists
   - Add `createPlaylist(name: string)` - POST /api/playlists
   - Add `getPlaylist(id: string)` - GET /api/playlists/{id}

**Verification:**
- Browser ID persists across page reloads
- API calls include X-Browser-Id header

---

### Task 2: Playlist UI Components

**Files to create:**
- `web/src/lib/Playlists/PlaylistCard.svelte` - Individual playlist card
- `web/src/lib/Playlists/PlaylistList.svelte` - Grid of playlist cards
- `web/src/lib/Playlists/CreatePlaylistModal.svelte` - Modal for new playlist name

**Implementation:**

1. Create `PlaylistCard.svelte`:
   - Props: `playlist: Playlist`, `onSelect: (id: string) => void`
   - Display: name, track count, last updated (formatted)
   - Styling: Match existing card patterns (bg-[#282828], hover effects)
   - Click handler calls `onSelect(playlist.id)`

2. Create `PlaylistList.svelte`:
   - Props: `playlists: Playlist[]`, `onSelect: (id: string) => void`, `onCreateNew: () => void`
   - Grid layout (responsive: 1 col mobile, 2 cols tablet, 3 cols desktop)
   - Map playlists to PlaylistCard components
   - Include "Create New Playlist" card with + icon
   - Empty state if no playlists

3. Create `CreatePlaylistModal.svelte`:
   - Props: `isOpen: boolean`, `onClose: () => void`, `onCreate: (name: string) => void`
   - Simple modal with backdrop
   - Text input for playlist name (default "My Playlist")
   - Cancel and Create buttons
   - Form validation (non-empty name)
   - Focus input on open

**Styling patterns (from existing components):**
- Background: `bg-[#282828]`
- Hover: `hover:bg-[#383838]`
- Border accent: `border-[#1DB954]`
- Text: white primary, `text-gray-400` secondary
- Buttons: `bg-[#1DB954]` primary, `bg-[#282828]` secondary

**Verification:**
- Components render correctly in isolation
- Modal opens/closes properly
- Create button disabled for empty name

---

### Task 3: Landing Page Integration with Auto-Create

**Files to create:**
- `web/src/lib/stores/selectedPlaylist.svelte.ts` - Selected playlist store

**Files to modify:**
- `web/src/App.svelte` - Integrate playlist selection on landing page

**Implementation:**

1. Create `selectedPlaylist.svelte.ts` store:
   - Store `selectedPlaylistId` in state
   - Persist to localStorage as `hitster-selected-playlist`
   - Export `getSelectedPlaylistId()`, `setSelectedPlaylistId(id)`
   - Export `clearSelectedPlaylist()`

2. Update `App.svelte`:
   - Import new components and stores
   - Add state: `playlists`, `isLoadingPlaylists`, `showCreateModal`, `selectedPlaylistId`
   - On mount effect:
     - Fetch playlists for browser ID
     - If no playlists exist, auto-create "My Playlist" and select it
     - If playlists exist, restore last selected or show selection
   - Add playlist section below hero on landing page:
     - "Your Playlists" heading
     - PlaylistList component
     - CreatePlaylistModal (hidden by default)
   - Handle playlist selection:
     - Store selected ID
     - Update UI to show "Working with: {playlist.name}"
   - Handle create new playlist:
     - Show modal, create via API, refresh list, select new playlist

3. Landing page layout update:
   - Keep existing hero and path choice (CSV/Playlist)
   - Add divider or section below
   - Show "Your Playlists" section with grid of cards
   - Selected playlist indicator above path choice buttons

**Flow:**
1. Page loads -> fetch playlists
2. If empty -> auto-create "My Playlist" -> select it
3. If exists -> show list, auto-select last used or first
4. User can click different playlist to switch
5. User can create new playlist via modal

**Verification (Chrome DevTools MCP):**
- First visit: "My Playlist" auto-created and shown
- Subsequent visits: Existing playlists displayed
- Create new playlist works
- Selection persists across page reload
- Selected playlist shown in UI

## Success Criteria

- [ ] Browser UUID generated on first visit, persisted in localStorage
- [ ] X-Browser-Id header sent with all API requests
- [ ] Playlists displayed in responsive grid on landing page
- [ ] Create new playlist modal works correctly
- [ ] First visit auto-creates "My Playlist"
- [ ] Selected playlist persisted in localStorage
- [ ] UI shows which playlist is currently selected

## Out of Scope (Phase 35+)

- Connecting playlist selection to CSV/Spotify flow
- Rename/delete playlist functionality
- Error toasts and loading skeletons
