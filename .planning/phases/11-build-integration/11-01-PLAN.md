---
phase: 11-build-integration
plan: 01
type: execute
---

<objective>
Integrate Svelte build into .NET project workflow so `dotnet run` automatically builds the frontend.

Purpose: Eliminate manual frontend build step - single command starts the full application.
Output: Modified .csproj with MSBuild targets that run npm install and npm build, outputting to wwwroot.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/10-static-file-serving/10-01-SUMMARY.md

**Prior decisions affecting this phase:**
- Phase 10 established wwwroot as the serving directory
- Static file middleware already configured in Program.cs
- Manual copy of build output working correctly

**Current state:**
- Frontend lives in `web/` directory with Vite/Svelte
- `npm run build` outputs to `web/dist/`
- Phase 10 manually copied dist to wwwroot
- Need to automate: web/dist/* -> wwwroot/

**Relevant source files:**
@HitsterCardGenerator.csproj
@web/package.json
@web/vite.config.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Configure Vite to output directly to wwwroot</name>
  <files>web/vite.config.ts</files>
  <action>
Update vite.config.ts to set build.outDir to '../wwwroot' instead of default 'dist'. This eliminates the copy step - Vite writes directly where .NET serves from.

Also set build.emptyOutDir to true so each build cleans the old assets.

Note: Keep the existing svelte and tailwind plugins unchanged.
  </action>
  <verify>Run `cd web && npm run build` - files appear in ../wwwroot/ not web/dist/</verify>
  <done>Vite outputs directly to wwwroot directory</done>
</task>

<task type="auto">
  <name>Task 2: Add MSBuild targets for frontend build</name>
  <files>HitsterCardGenerator.csproj</files>
  <action>
Add MSBuild targets to the .csproj file:

1. Target "NpmInstall" - runs `npm install` in web/ directory
   - Condition: runs only if node_modules doesn't exist or package.json is newer
   - BeforeTargets: NpmBuild

2. Target "NpmBuild" - runs `npm run build` in web/ directory
   - BeforeTargets: Build
   - This ensures frontend is built before .NET compilation

Use Exec task with WorkingDirectory="web" for both targets.

Important: Use cross-platform npm command - on Windows use `npm.cmd`, detect OS with $([MSBuild]::IsOSPlatform('Windows')).
  </action>
  <verify>Run `dotnet build` from project root - should see npm install and npm build output in console</verify>
  <done>Frontend builds automatically as part of `dotnet build`</done>
</task>

<task type="auto">
  <name>Task 3: Clean up old dist directory and test full workflow</name>
  <files>web/.gitignore, .gitignore</files>
  <action>
1. Delete web/dist/ directory if it exists (no longer needed)
2. Ensure wwwroot/ is in root .gitignore (build output shouldn't be committed)
3. Ensure web/dist is NOT in web/.gitignore (not needed anymore, but harmless)
4. Run full workflow test: `dotnet run` should build frontend and serve application
  </action>
  <verify>
- `dotnet run` works from fresh clone (npm install + build + run)
- Navigate to http://localhost:5000 - app loads correctly
- wwwroot/ contains built assets (index.html, assets/)
  </verify>
  <done>Single `dotnet run` builds and serves complete application</done>
</task>

</tasks>

<verification>
Before declaring phase complete:
- [ ] `dotnet build` triggers npm install and npm build
- [ ] wwwroot/ contains Vite output (index.html, assets/)
- [ ] `dotnet run` starts server and app works at http://localhost:5000
- [ ] No manual steps required between git clone and running app
</verification>

<success_criteria>

- MSBuild targets in .csproj automate frontend build
- Vite outputs directly to wwwroot (no copy step)
- Single `dotnet run` command starts complete application
- Works on fresh clone (npm install happens automatically)
</success_criteria>

<output>
After completion, create `.planning/phases/11-build-integration/11-01-SUMMARY.md`
</output>
