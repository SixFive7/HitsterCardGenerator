---
phase: 08-card-preview
plan: 1
type: execute
---

<objective>
Set up card carousel foundation with Embla, create card components with flip animation.

Purpose: Establish the core card preview infrastructure that all customization features depend on.
Output: CardCarousel, CardFront, CardBack components with Embla navigation and CSS 3D flip.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/08-card-preview/08-CONTEXT.md
@.planning/phases/08-card-preview/08-RESEARCH.md
@.planning/phases/07-spotify-web-flow/07-02-SUMMARY.md

**Prior decisions affecting this phase:**
- Svelte 5 runes pattern ($state, $derived, $effect) established in Phase 5
- Spotify-inspired colors (#1DB954 green, #FF6B6B coral, #191414 dark) from Phase 5
- MatchResult[] contains SpotifyMatch with trackId, albumImageUrl, spotifyUrl

**Existing genre colors to port:**
@Models/GenreColors.cs - 35 genreâ†’hex mappings to use as defaults

**Relevant source files:**
@web/src/App.svelte - Current flow, matchResults state
@web/src/lib/types.ts - MatchResult, SpotifyMatch interfaces
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install packages and create cardCustomization store</name>
  <files>web/package.json, web/src/lib/stores/cardCustomization.ts, web/src/lib/types.ts</files>
  <action>
1. Install embla-carousel-svelte and svelte-awesome-color-picker:
   `cd web && npm install embla-carousel-svelte svelte-awesome-color-picker -D`

2. Create web/src/lib/stores/ directory

3. Create cardCustomization.ts with Svelte 5 $state runes:
   - DEFAULT_GENRE_COLORS: Record<string, string> - port all 35 colors from GenreColors.cs
   - genreColors: $state<Record<string, string>> initialized from DEFAULT_GENRE_COLORS
   - includedCards: $state<Set<number>> - indexes of cards to include (all included by default)
   - currentCardIndex: $state<number> - currently viewed card
   - Export functions: setGenreColor, toggleCardInclusion, resetGenreColors, getGenreColor

4. Add CardCustomization interface to types.ts:
   - genreColors: Record<string, string>
   - includedCards: Set<number>
   - currentCardIndex: number
  </action>
  <verify>npm install succeeds, new files exist, TypeScript compiles without errors</verify>
  <done>Packages installed, cardCustomization store exports state and functions, types defined</done>
</task>

<task type="auto">
  <name>Task 2: Create CardFront, CardBack, and CardCarousel components</name>
  <files>web/src/lib/CardPreview/CardFront.svelte, web/src/lib/CardPreview/CardBack.svelte, web/src/lib/CardPreview/CardCarousel.svelte</files>
  <action>
1. Create web/src/lib/CardPreview/ directory

2. Create CardFront.svelte:
   - Props: spotifyUrl (for QR placeholder), albumImageUrl
   - Display album art as placeholder for QR code (actual QR generation is Phase 9)
   - Use aspect-ratio: 17/11 (85:55mm ratio)
   - Style: white background, centered content, rounded corners, shadow

3. Create CardBack.svelte:
   - Props: artist, year, title, genre, backgroundColor (from genreColors)
   - Layout matching CardDesigner.cs: artist top (small), year center (large bold), title below (medium), genre bottom (small)
   - Use aspect-ratio: 17/11
   - Style: genre background color with 80% opacity, text colors for contrast

4. Create CardCarousel.svelte:
   - Props: cards (MatchResult[]), genreColors (Record<string, string>)
   - Use embla-carousel-svelte with options: { loop: false, align: 'center' }
   - Track selectedIndex via emblaApi.on('select')
   - Each slide contains a flippable card container:
     - CSS 3D flip with perspective-1000, transform-style: preserve-3d
     - flipped state toggles rotateY(180deg)
     - CardFront on front face (backface-hidden)
     - CardBack on back face (backface-hidden, rotateY(180deg))
   - Click card to flip
   - Export currentIndex for parent sync
   - Style: embla overflow-hidden, container flex, slides flex-[0_0_100%]
  </action>
  <verify>cd web && npm run build succeeds, no TypeScript errors, components export correctly</verify>
  <done>Three components created with Embla carousel, CSS flip animation, proper card aspect ratio</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `cd web && npm run build` succeeds without errors
- [ ] embla-carousel-svelte and svelte-awesome-color-picker in package.json devDependencies
- [ ] cardCustomization.ts exports genreColors, includedCards, currentCardIndex, helper functions
- [ ] CardCarousel.svelte uses embla-carousel-svelte action
- [ ] Card flip animation uses CSS 3D transforms
</verification>

<success_criteria>
- All tasks completed
- All verification checks pass
- No TypeScript errors
- Card components ready for integration in Plan 2
</success_criteria>

<output>
After completion, create `.planning/phases/08-card-preview/08-01-SUMMARY.md`
</output>
