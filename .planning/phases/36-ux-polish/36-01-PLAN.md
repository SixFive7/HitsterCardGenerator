# Plan 36-01: UX Polish

## Objective

Add finishing touches to the playlist management experience with toast notifications, loading states, and complete playlist management (rename/delete).

**Purpose:** Provide a polished user experience with clear feedback for all operations, error handling that doesn't block the workflow, and full control over playlists.

**Output:** Toast notification system, loading states during API operations, and playlist rename/delete functionality.

## Context

**Current State:**
- Phase 35 completed flow integration with API persistence
- API errors are logged to console but not shown to users
- No loading indicators during save operations
- Playlists can only be created, not renamed or deleted
- Existing components: PlaylistList, PlaylistCard, CreatePlaylistModal

**Target State:**
- Toast notifications appear for errors (and success where appropriate)
- Loading spinners/disabled states during API calls
- Users can rename playlists via inline edit or modal
- Users can delete playlists with confirmation dialog

**Files to reference:**
- `web/src/App.svelte` - Main app with playlist management
- `web/src/lib/api.ts` - API functions (need rename/delete endpoints)
- `web/src/lib/Playlists/PlaylistCard.svelte` - Playlist card component
- `web/src/lib/Playlists/PlaylistList.svelte` - Playlist list component
- `web/src/lib/Playlists/CreatePlaylistModal.svelte` - Modal reference for styling

**Prior decisions affecting this phase:**
- Keep toast design consistent with existing UI (Spotify-inspired colors)
- Delete confirmation is important to prevent accidental loss
- Loading states should be subtle, not jarring
- Consider keyboard accessibility for modals

## Tasks

### Task 1: Toast Notification System

**Files to create/modify:**
- `web/src/lib/stores/toast.svelte.ts` - Toast store (create)
- `web/src/lib/Toast/Toast.svelte` - Individual toast component (create)
- `web/src/lib/Toast/ToastContainer.svelte` - Container for positioning toasts (create)
- `web/src/App.svelte` - Add ToastContainer to app

**Action:**

1. Create `web/src/lib/stores/toast.svelte.ts`:
```typescript
// Toast types: success, error, info
// Store shape: { toasts: Toast[] }
// Functions: showToast(message, type), dismissToast(id)
// Auto-dismiss after 5 seconds
```

2. Create `web/src/lib/Toast/Toast.svelte`:
- Individual toast with icon, message, and close button
- Colors: success (#1DB954), error (#FF6B6B), info (#3B82F6)
- Slide-in animation from top-right
- Progress bar for auto-dismiss countdown

3. Create `web/src/lib/Toast/ToastContainer.svelte`:
- Fixed position top-right
- Stacks multiple toasts vertically
- z-index above modals

4. Add ToastContainer to App.svelte (outside main content, always rendered)

**Verify:**
- Toast appears when showToast() is called
- Toast auto-dismisses after 5 seconds
- Toast can be manually dismissed
- Multiple toasts stack properly

**Done:** Toast notification system ready for use

---

### Task 2: Loading States and Error Handling

**Files to modify:**
- `web/src/App.svelte` - Add loading states and toast integration
- `web/src/lib/api.ts` - No changes needed (errors already thrown)
- `web/src/lib/stores/playlist.svelte.ts` - Add loading state tracking

**Action:**

1. Add loading state tracking to playlist store:
- `isLoading` state for track operations
- Set loading true before API calls, false after

2. Update App.svelte for loading states:
- Show spinner in playlist section during loadPlaylists
- Disable "Continue to Preview" button during track save
- Show loading indicator when switching playlists

3. Add toast notifications for errors:
- Failed to load playlists: show error toast
- Failed to create playlist: show error toast
- Failed to add track: show error toast
- Failed to remove track: show error toast

4. Add success toasts where appropriate:
- Playlist created successfully
- Track added successfully (optional, may be too noisy)

5. Wrap API calls in try/catch with toast on error:
```typescript
try {
  await someApiCall()
} catch (error) {
  showToast(error.message, 'error')
}
```

**Verify (Chrome DevTools MCP):**
- Loading spinner appears during playlist load
- Error toast appears when API fails (simulate with network throttling/offline)
- Buttons disabled during save operations
- User can continue after dismissing error

**Done:** Loading states and error handling integrated with toast system

---

### Task 3: Playlist Rename and Delete

**Files to create/modify:**
- `Endpoints/PlaylistEndpoints.cs` - Add PUT and DELETE endpoints
- `web/src/lib/api.ts` - Add renamePlaylist and deletePlaylist functions
- `web/src/lib/Playlists/PlaylistCard.svelte` - Add edit/delete buttons
- `web/src/lib/Playlists/EditPlaylistModal.svelte` - Modal for renaming (create)
- `web/src/lib/Playlists/DeleteConfirmModal.svelte` - Confirmation dialog (create)
- `web/src/App.svelte` - Handle rename/delete events

**Action:**

1. Add backend endpoints in `PlaylistEndpoints.cs`:
```csharp
// PUT /api/playlists/{id} - Rename playlist
// DELETE /api/playlists/{id} - Delete playlist (and its tracks)
```

2. Add API functions in `api.ts`:
```typescript
export async function renamePlaylist(id: string, name: string): Promise<Playlist>
export async function deletePlaylist(id: string): Promise<void>
```

3. Create `EditPlaylistModal.svelte`:
- Similar style to CreatePlaylistModal
- Pre-populated with current name
- Save and Cancel buttons
- Focus name input on open

4. Create `DeleteConfirmModal.svelte`:
- Warning icon and message
- Show playlist name and track count
- "Delete" (red) and "Cancel" buttons
- Cannot delete the only playlist (show disabled/message)

5. Update `PlaylistCard.svelte`:
- Add edit (pencil) and delete (trash) icon buttons
- Emit onEdit and onDelete events

6. Update App.svelte:
- Handle edit/delete events from PlaylistCard
- Open modals and process actions
- Refresh playlist list after changes
- Select another playlist if current is deleted
- Show success toast after rename/delete

**Verify (Chrome DevTools MCP):**
- Edit button opens rename modal with current name
- Rename updates playlist name in UI and API
- Delete button opens confirmation dialog
- Confirming delete removes playlist
- Cannot delete last playlist
- Appropriate toasts for success/error

**Done:** Full playlist management with rename and delete

---

## Verification

Before declaring phase complete:
- [ ] `npm run build` succeeds in web/
- [ ] `dotnet build` succeeds
- [ ] Toast notifications appear for errors
- [ ] Loading spinners show during API operations
- [ ] Playlists can be renamed via modal
- [ ] Playlists can be deleted with confirmation
- [ ] Cannot delete the last playlist
- [ ] All operations show appropriate feedback

## Success Criteria

1. Toast notification system works for errors and success
2. Loading states provide visual feedback during API calls
3. Playlists can be renamed
4. Playlists can be deleted with confirmation
5. User experience is polished and responsive

## Technical Notes

**Toast System:**
Use Svelte 5 runes ($state) for reactive toast array. Auto-dismiss uses setTimeout with cleanup on manual dismiss.

**Loading States:**
Track loading at the store level for global state, and locally in App.svelte for specific operations.

**Delete Protection:**
Prevent deleting the last playlist to ensure users always have at least one playlist to work with.

**Modal Styling:**
Match existing CreatePlaylistModal styling for consistency (bg-[#282828], rounded-xl, etc.).

## Out of Scope

- Track reordering within playlist
- Offline support / optimistic updates
- Undo functionality
- Batch operations (delete multiple playlists)

## Output

After completion, create `.planning/phases/36-ux-polish/36-01-SUMMARY.md`:

```markdown
# Phase 36: UX Polish Summary

**[One-liner describing what was accomplished]**

## Accomplishments

- [ ] Toast notification system implemented
- [ ] Loading states added to API operations
- [ ] Playlist rename functionality added
- [ ] Playlist delete with confirmation added

## Files Created/Modified

- `web/src/lib/stores/toast.svelte.ts` - Toast state management
- `web/src/lib/Toast/Toast.svelte` - Toast component
- `web/src/lib/Toast/ToastContainer.svelte` - Toast container
- `web/src/lib/Playlists/EditPlaylistModal.svelte` - Rename modal
- `web/src/lib/Playlists/DeleteConfirmModal.svelte` - Delete confirmation
- `web/src/lib/Playlists/PlaylistCard.svelte` - Added edit/delete buttons
- `web/src/lib/api.ts` - Added rename/delete functions
- `Endpoints/PlaylistEndpoints.cs` - Added PUT/DELETE endpoints
- `web/src/App.svelte` - Integrated toasts and modals

## Decisions Made

| Decision | Rationale |
|----------|-----------|
| ... | ... |

## Issues Encountered

None / List any issues

## Next Phase Readiness

Milestone v3.0 complete - ready for milestone completion
```
