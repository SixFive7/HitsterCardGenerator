# Plan 30-01: Automated E2E Testing with Chrome DevTools MCP

## Objective

Create an automated end-to-end test script using Chrome DevTools MCP tools to verify the complete application flow: CSV upload -> Spotify matching -> card preview -> card flip -> PDF export. Document how to run the tests.

## Prerequisites

- Application running at http://localhost:5000
- Chrome DevTools MCP tools available
- Test CSV file (`test_data.csv`) in project root
- Spotify credentials configured (for API matching)

## Test Approach

Use Chrome DevTools MCP tools to:
1. Navigate through the application
2. Interact with UI elements (click, fill)
3. Take snapshots and screenshots to verify state
4. Test the complete user journey

The test will use the **CSV upload flow** since it covers the most functionality (upload -> validation -> Spotify matching -> preview -> export).

## Execution Tasks

### Task 1: Create E2E Test Script

**Action:** Create a TypeScript test script that uses Chrome DevTools MCP tools programmatically

The test script will be a documentation-style markdown file that describes the manual steps to run the E2E test using Chrome DevTools MCP. Since MCP tools are invoked through Claude, the "script" serves as a repeatable test procedure.

Create `tests/e2e-test-procedure.md`:

```markdown
# E2E Test Procedure using Chrome DevTools MCP

This document describes how to run a complete E2E test of the Hitster Card Generator application using Chrome DevTools MCP tools.

## Prerequisites

1. Start the application: `dotnet run`
2. Ensure Spotify credentials are configured in environment variables
3. Have Chrome DevTools MCP tools available

## Test Steps

### Step 1: Navigate to Application
Tool: `navigate_page`
URL: http://localhost:5000

### Step 2: Verify Landing Page
Tool: `take_snapshot`
Expected: Page contains "Hitster Card Generator", "Connected to backend", "Upload CSV" button

### Step 3: Start CSV Upload Flow
Tool: `click`
Target: "Upload CSV" button
Tool: `take_snapshot`
Expected: "Upload Your Song List" heading visible

### Step 4: Upload Test CSV
Tool: `upload_file`
Element: file input
File: test_data.csv
Tool: `take_snapshot`
Expected: "Upload Results" with valid songs listed

### Step 5: Match with Spotify
Tool: `click`
Target: "Match with Spotify" button
Tool: `wait_for`
Text: "Spotify Matches"
Tool: `take_snapshot`
Expected: "Matching Complete" with matched songs

### Step 6: Continue to Preview
Tool: `click`
Target: "Continue to Preview" button
Tool: `take_snapshot`
Expected: "Preview Your Cards" heading, card carousel visible

### Step 7: Test Card Flip
Tool: `click`
Target: card element (card-flip-container)
Tool: `take_screenshot`
Expected: Card shows back side (song info, album art)

### Step 8: Navigate to Export
Tool: `click`
Target: "Continue to Export" button
Tool: `take_snapshot`
Expected: "Export Your Cards" heading, export options visible

### Step 9: Download PDF
Tool: `click`
Target: "Download PDF" button
Tool: `wait_for`
Text: "Download Started!" or check for PDF generation
Tool: `take_screenshot`
Expected: Success message or download initiated

### Step 10: Test Start New Batch
Tool: `click`
Target: "Start New Batch" button
Tool: `take_snapshot`
Expected: Returns to landing page with "Upload CSV" option

## Success Criteria

- All steps complete without errors
- Landing page loads with backend connected
- CSV upload validates correctly
- Spotify matching returns results
- Card preview displays with flip functionality
- PDF export initiates successfully
- Flow can be restarted
```

**Files to create:**
- `tests/e2e-test-procedure.md`

**Verification:** File created with complete test procedure

---

### Task 2: Run E2E Test and Document Results

**Action:** Execute the E2E test procedure using Chrome DevTools MCP tools and document the results

1. Start the application if not running:
   ```bash
   cd /workspaces/HitsterCardGenerator
   dotnet run
   ```

2. Execute each step from the test procedure:
   - Navigate to http://localhost:5000
   - Take snapshot to verify landing page
   - Click "Upload CSV"
   - Upload test_data.csv
   - Verify validation results
   - Click "Match with Spotify"
   - Wait for matching to complete
   - Click "Continue to Preview"
   - Click on card to flip
   - Take screenshot of flipped card
   - Click "Continue to Export"
   - Click "Download PDF"
   - Verify PDF generation
   - Click "Start New Batch"
   - Verify return to landing

3. Document results in test log

**Verification:** All test steps pass, screenshots captured as evidence

---

### Task 3: Document How to Run Tests

**Action:** Update README.md with E2E testing section

Add to README.md:

```markdown
## E2E Testing

The project includes an E2E test procedure that can be executed using Chrome DevTools MCP tools.

### Test File
- `tests/e2e-test-procedure.md` - Complete test procedure with steps

### Running Tests

1. Start the application:
   ```bash
   dotnet run
   ```

2. Use Chrome DevTools MCP to execute the test procedure:
   - Open the test procedure file
   - Execute each step using the appropriate MCP tool
   - Verify expected outcomes at each step

### Test Coverage

The E2E test covers:
- Landing page load and API connection
- CSV file upload and validation
- Spotify track matching
- Card preview with carousel
- Card flip functionality
- PDF export
- Flow restart (Start New Batch)
```

**Files to modify:**
- `README.md` - Add E2E testing section

**Verification:** README includes testing documentation

---

## Completion Criteria

1. Test procedure file created at `tests/e2e-test-procedure.md`
2. E2E test executed successfully with all steps passing
3. Card flip functionality verified (specific bug that was fixed)
4. PDF export verified
5. README updated with testing documentation
6. Test evidence captured (snapshots/screenshots)

## Test Data

Using `test_data.csv` which contains:
```csv
title;artist;year;genre
Billie Jean;Michael Jackson;1983;Pop
Bohemian Rhapsody;Queen;1975;Rock
Stairway to Heaven;Led Zeppelin;1971;Rock
```

These are well-known songs that should match reliably on Spotify.

## Notes

This phase completes milestone v2.8 (Simplification). The E2E test provides confidence that the unified rendering, simplified color system, and card redesign from previous phases all work together in the complete user flow.

The Chrome DevTools MCP approach allows Claude to:
- Verify the UI visually without human intervention
- Execute the same test procedure consistently
- Capture evidence (screenshots/snapshots) for documentation
