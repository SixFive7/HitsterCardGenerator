---
phase: 05-web-foundation
plan: 01
type: execute
---

<objective>
Transform the .NET console application into a Minimal API backend ready for web frontend integration.

Purpose: Create the API foundation that the Svelte frontend will communicate with, establishing endpoint patterns and service registration.
Output: Working Minimal API with health check endpoint, proper project SDK, and endpoint structure ready for feature endpoints.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/05-web-foundation/05-RESEARCH.md
@.planning/phases/05-web-foundation/05-CONTEXT.md

**Prior decisions affecting this phase:**
- .NET 10 target framework maintained
- Existing services (CsvParser, SpotifyService, QrCodeService, CardDesigner, PdfExporter) will be reused via dependency injection
- QuestPDF license setting must be preserved

**Current state:**
- Console app with wizard UI in Program.cs
- Services in /Services folder ready for reuse
- Models in /Models folder ready for reuse

**Transformation approach:**
- Replace console Program.cs with Minimal API pattern
- Change SDK from Microsoft.NET.Sdk to Microsoft.NET.Sdk.Web
- Create Endpoints/ folder for route handlers following MapGroup pattern
</context>

<tasks>

<task type="auto">
  <name>Task 1: Update project to Web SDK</name>
  <files>HitsterCardGenerator.csproj</files>
  <action>
Change SDK from Microsoft.NET.Sdk to Microsoft.NET.Sdk.Web. Remove OutputType (web SDK defaults to Exe). Keep existing package references (QRCoder, QuestPDF, Spectre.Console, SpotifyAPI.Web) - we'll remove unused ones later when console code is fully deprecated.

Add Microsoft.AspNetCore.OpenApi package for API documentation capability.
  </action>
  <verify>dotnet restore succeeds, project compiles</verify>
  <done>Project uses Web SDK, restore succeeds</done>
</task>

<task type="auto">
  <name>Task 2: Create Minimal API Program.cs</name>
  <files>Program.cs</files>
  <action>
Replace the console wizard Program.cs with Minimal API setup:

1. Create WebApplication.CreateBuilder(args)
2. Set QuestPDF.Settings.License = LicenseType.Community (preserve existing requirement)
3. Register services for DI:
   - AddSingleton<GenreValidator>()
   - AddSingleton<CsvParser>() (takes GenreValidator)
   - AddSingleton<QrCodeService>()
   - AddSingleton<CardDesigner>()
   - AddSingleton<PdfExporter>()
   - Note: SpotifyService needs credentials at runtime, will be handled differently in later phases
4. Add OpenAPI services: builder.Services.AddOpenApi()
5. Build app, map endpoints using extension methods
6. Map OpenAPI endpoint: app.MapOpenApi()
7. Configure to listen on port 5000 for Vite proxy compatibility

Keep the Program.cs clean by using extension methods for endpoint mapping (defined in Endpoints/ files).

Note: Spectre.Console imports will cause warnings/errors as they're console-specific - that's expected and will be cleaned up when we fully migrate.
  </action>
  <verify>dotnet build succeeds, dotnet run starts server on port 5000</verify>
  <done>Minimal API starts, listening on http://localhost:5000</done>
</task>

<task type="auto">
  <name>Task 3: Create health check endpoint</name>
  <files>Endpoints/HealthEndpoints.cs</files>
  <action>
Create Endpoints/ folder and HealthEndpoints.cs establishing the endpoint pattern:

1. Create static class HealthEndpoints
2. Create extension method MapHealthEndpoints(this WebApplication app)
3. Map GET /api/health returning { status: "ok", timestamp: DateTime.UtcNow }
4. Map GET /api/health/ready returning service readiness (always true for now)

This establishes the pattern for all future endpoint files (SongsEndpoints, SpotifyEndpoints, ExportEndpoints).

Register in Program.cs: app.MapHealthEndpoints()
  </action>
  <verify>curl http://localhost:5000/api/health returns 200 with JSON response</verify>
  <done>Health endpoint responds, endpoint pattern established</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `dotnet build` succeeds without errors
- [ ] `dotnet run` starts server on port 5000
- [ ] `curl http://localhost:5000/api/health` returns JSON with status "ok"
- [ ] OpenAPI docs available at /openapi/v1.json
</verification>

<success_criteria>
- Project uses Microsoft.NET.Sdk.Web
- Minimal API running on port 5000
- Health check endpoint responding
- Service DI registered for existing services
- Endpoints/ folder structure established
</success_criteria>

<output>
After completion, create `.planning/phases/05-web-foundation/05-01-SUMMARY.md`
</output>
