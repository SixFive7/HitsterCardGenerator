---
phase: 15-github-actions-ci
plan: 01
type: execute
---

<objective>
Set up GitHub Actions CI for automated Docker image releases to GHCR.

Purpose: Enable automated build, verification, and publishing when semantic version tags are pushed.
Output: `.github/workflows/release.yml` workflow + `CHANGELOG.md` with Keep a Changelog format.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/15-github-actions-ci/15-RESEARCH.md
@.planning/phases/15-github-actions-ci/15-CONTEXT.md
@Dockerfile

**Repository:** SixFive7/HitsterCardGenerator (GitHub)

**Key findings from research:**
- Use docker/build-push-action@v6 with docker/metadata-action@v5
- GHCR auth: `packages: write` permission + GITHUB_TOKEN (no PAT needed)
- GHA cache: `cache-from: type=gha`, `cache-to: type=gha,mode=max`
- CHANGELOG extraction: ffurrer2/extract-release-notes@v2
- .NET caching: actions/setup-dotnet@v5 with cache: true (but requires lock files)

**Project constraints:**
- No test project exists â†’ skip `dotnet test` step
- `dotnet format` needs explicit solution: `dotnet format HitsterCardGenerator.sln --verify-no-changes`
- .NET 10 target framework

**User vision (from CONTEXT.md):**
- Tag push (v*.*.*) triggers workflow automatically
- Full verification before publish (build + format check)
- Version tag + :latest image tags
- Auto GitHub Release with notes from CHANGELOG.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create GitHub Actions release workflow</name>
  <files>.github/workflows/release.yml</files>
  <action>
Create release workflow with two jobs:

**Job 1: verify**
- Trigger: push tags matching `v*.*.*`
- Runner: ubuntu-latest
- Steps:
  1. actions/checkout@v4
  2. actions/setup-dotnet@v5 with dotnet-version: '10.x' (no cache - lock files don't exist)
  3. `dotnet restore`
  4. `dotnet build --no-restore --configuration Release`
  5. `dotnet format HitsterCardGenerator.sln --verify-no-changes` (explicit solution path required)

**Job 2: release**
- needs: verify
- permissions: contents: write, packages: write
- Steps:
  1. actions/checkout@v4
  2. docker/login-action@v3 (registry: ghcr.io, username: github.actor, password: GITHUB_TOKEN)
  3. docker/metadata-action@v5 (images: ghcr.io/${{ github.repository }}, tags: semver + latest)
  4. docker/setup-buildx-action@v3
  5. docker/build-push-action@v6 (context: ., push: true, GHA cache enabled)
  6. ffurrer2/extract-release-notes@v2
  7. gh release create with extracted notes

**Important:**
- Use `context: .` in build-push-action (not git context) to respect .dockerignore
- Tag patterns: `type=semver,pattern={{version}}` and `type=raw,value=latest`
- Cache: `cache-from: type=gha` and `cache-to: type=gha,mode=max`
  </action>
  <verify>Workflow YAML is valid: `cat .github/workflows/release.yml | head -50` shows expected structure</verify>
  <done>release.yml exists with verify job (restore, build, format) and release job (GHCR push + GitHub release)</done>
</task>

<task type="auto">
  <name>Task 2: Create CHANGELOG.md with Keep a Changelog format</name>
  <files>CHANGELOG.md</files>
  <action>
Create CHANGELOG.md following Keep a Changelog format with hybrid style (narrative intro + categorized changes).

Structure:
```markdown
# Changelog

All notable changes to this project will be documented in this file.

The format is based on [Keep a Changelog](https://keepachangelog.com/en/1.1.0/),
and this project adheres to [Semantic Versioning](https://semver.org/spec/v2.0.0.html).

## [Unreleased]

## [2.3.0] - YYYY-MM-DD

[Narrative intro about v2.3 Containerization milestone]

### Added
- Docker image with multi-stage build for easy deployment
- GitHub Actions CI for automated releases to GHCR
- Health check endpoint at `/api/health`
- VS Code launch configuration for F5 debugging

### Changed
- Application port changed from 5000 to 8080 (non-root container compatibility)
- Frontend build only runs in Release mode (faster Debug builds)

## [2.2.0] - 2025-12-22

[Brief intro about devcontainer]

### Added
- Devcontainer for Claude Code development

## [2.1.0] - 2025-12-22

[Brief intro about single-process startup]

### Added
- Static file serving (.NET serves Svelte build)
- MSBuild integration for frontend build

## [2.0.0] - 2025-12-21

[Brief intro about web interface transformation]

### Added
- Web interface with Svelte + Tailwind frontend
- Drag-drop CSV upload with validation
- Interactive card preview carousel
- Genre color customization with palettes
- Card curation (include/exclude)
- PDF export with cutting lines

### Changed
- Migrated from console wizard to web application

## [1.0.0] - 2025-12-21

Initial release of Hitster Card Generator.

### Added
- CSV import with validation (semicolon-separated)
- Spotify track matching with smart selection
- QR code generation linking to Spotify tracks
- PDF export with credit-card sized cards (85x55mm)
- 30+ genre validation including French genres
```

Use placeholder `YYYY-MM-DD` for v2.3.0 date (filled when tagging release).
  </action>
  <verify>CHANGELOG.md exists and contains [Unreleased] and version sections: `head -30 CHANGELOG.md`</verify>
  <done>CHANGELOG.md created with Keep a Changelog format, all versions documented, ready for extract-release-notes action</done>
</task>

</tasks>

<verification>
Before declaring phase complete:
- [ ] `.github/workflows/release.yml` exists with valid YAML structure
- [ ] Workflow triggers on `v*.*.*` tags
- [ ] Verify job runs dotnet restore, build, format
- [ ] Release job has packages:write and contents:write permissions
- [ ] CHANGELOG.md exists with Keep a Changelog format
- [ ] All previous versions (1.0.0, 2.0.0, 2.1.0, 2.2.0) documented
</verification>

<success_criteria>
- Workflow file created with correct structure
- CHANGELOG.md ready for release notes extraction
- No syntax errors in YAML
- Phase 15 complete, ready for Phase 16 (multi-arch builds)
</success_criteria>

<output>
After completion, create `.planning/phases/15-github-actions-ci/15-01-SUMMARY.md`:

# Phase 15 Plan 01: GitHub Actions CI Summary

**[Substantive one-liner]**

## Accomplishments

- Created release workflow for GHCR publishing
- Created CHANGELOG.md with full version history

## Files Created/Modified

- `.github/workflows/release.yml` - Tag-triggered CI/CD workflow
- `CHANGELOG.md` - Keep a Changelog format with all versions

## Decisions Made

[Any decisions during implementation]

## Issues Encountered

[Problems and resolutions, or "None"]

## Next Step

Phase 15 complete, ready for Phase 16 (Multi-Architecture & User Docs)
</output>
